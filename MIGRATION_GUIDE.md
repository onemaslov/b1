# Миграция базы данных и добавление авторизации

## Шаги для применения изменений

### 1. Установка зависимостей (tsx для seed скрипта)
```bash
npm install
```

### 2. Создание миграции
```bash
npx prisma migrate dev --name add_auth
```

Эта команда:
- Создаст новую миграцию для добавления таблицы User
- Добавит связь между User и Marker
- Применит миграцию к базе данных
- Сгенерирует Prisma Client

### 3. Заполнение базы тестовыми данными (создание admin пользователя)
```bash
npm run db:seed
```

Или напрямую:
```bash
npx tsx prisma/seed.ts
```

Это создаст пользователя:
- **Логин**: admin
- **Пароль**: qwerty

### 4. Перезапуск сервера разработки
```bash
npm run dev
```

## Что изменилось

### База данных:
- ✅ Добавлена таблица `users` с полями: id, username, password
- ✅ В таблицу `markers` добавлено поле `userId`
- ✅ Установлена связь один-ко-многим между User и Marker
- ✅ Cascade удаление: при удалении пользователя удаляются все его метки

### API:
- ✅ `/api/auth/login` - авторизация
- ✅ `/api/auth/logout` - выход
- ✅ `/api/auth/session` - проверка сессии
- ✅ Все endpoints меток теперь фильтруют по userId из cookie

### Фронтенд:
- ✅ Страница входа `/login`
- ✅ Middleware для защиты главной страницы
- ✅ Кнопка выхода на главной странице
- ✅ Автоматическое перенаправление неавторизованных пользователей

## Важно

⚠️ **В production следует:**
- Использовать bcrypt для хеширования паролей
- Использовать JWT токены вместо простых cookies
- Добавить CSRF защиту
- Использовать HTTPS

Текущая реализация подходит для разработки и демонстрации.

